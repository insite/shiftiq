(function(){function b(t,e){return function(){return t.apply(e,arguments)}}var Q=[].indexOf||function(t){for(var e=0,n=this.length;e<n;e++)if(e in this&&this[e]===t)return e;return-1},C=[].slice,Y={}.hasOwnProperty;(function(t){"object"==typeof exports&&"object"==typeof module?t(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)})(function(P){var J,n,u,t,l,e,G,W,s,$,r,c,d,a,h,p,f,i,m,g,o;function v(t,e){var n;null==e&&(e={}),this.getAggregator=b(this.getAggregator,this),this.getRowKeys=b(this.getRowKeys,this),this.getColKeys=b(this.getColKeys,this),this.sortKeys=b(this.sortKeys,this),this.arrSort=b(this.arrSort,this),this.input=t,this.aggregator=null!=(t=e.aggregator)?t:u.count()(),this.aggregatorName=null!=(t=e.aggregatorName)?t:"Count",this.colAttrs=null!=(t=e.cols)?t:[],this.rowAttrs=null!=(t=e.rows)?t:[],this.valAttrs=null!=(t=e.vals)?t:[],this.sorters=null!=(t=e.sorters)?t:{},this.rowOrder=null!=(t=e.rowOrder)?t:"key_a_to_z",this.colOrder=null!=(t=e.colOrder)?t:"key_a_to_z",this.derivedAttributes=null!=(t=e.derivedAttributes)?t:{},this.filter=null!=(e=e.filter)?e:function(){return!0},this.tree={},this.rowKeys=[],this.colKeys=[],this.rowTotals={},this.colTotals={},this.allTotal=this.aggregator(this,[],[]),this.sorted=!1,v.forEachRecord(this.input,this.derivedAttributes,(n=this,function(t){if(n.filter(t))return n.processRecord(t)}))}return n=function(t,e,n){for(var r=(t=(t+="").split("."))[0],t=1<t.length?n+t[1]:"",a=/(\d+)(\d{3})/;a.test(r);)r=r.replace(a,"$1"+e+"$2");return r+t},f=(r=function(e){var t={digitsAfterDecimal:2,scaler:1,thousandsSep:",",decimalSep:".",prefix:"",suffix:""};return e=P.extend({},t,e),function(t){return isNaN(t)||!isFinite(t)?"":(t=n((e.scaler*t).toFixed(e.digitsAfterDecimal),e.thousandsSep,e.decimalSep),""+e.prefix+t+e.suffix)}})(),i=r({digitsAfterDecimal:0}),m=r({digitsAfterDecimal:1,scaler:100,suffix:"%"}),t={Count:(o=u={count:function(r){return null==r&&(r=i),function(){return function(t,e,n){return{count:0,push:function(){return this.count++},value:function(){return this.count},format:r}}}},uniques:function(a,o){return null==o&&(o=i),function(t){var r=t[0];return function(t,e,n){return{uniq:[],push:function(t){var e=t[r];if(Q.call(this.uniq,e)<0)return this.uniq.push(t[r])},value:function(){return a(this.uniq)},format:o,numInputs:null!=r?0:1}}}},sum:function(a){return null==a&&(a=f),function(t){var r=t[0];return function(t,e,n){return{sum:0,push:function(t){if(!isNaN(parseFloat(t[r])))return this.sum+=parseFloat(t[r])},value:function(){return this.sum},format:a,numInputs:null!=r?0:1}}}},extremes:function(a,o){return null==o&&(o=f),function(t){var r=t[0];return function(t,e,n){return{val:null,sorter:G(null!=t?t.sorters:void 0,r),push:function(t){var e,n=t[r];if("min"!==a&&"max"!==a||(n=parseFloat(n),isNaN(n)||(this.val=Math[a](n,null!=(t=this.val)?t:n))),"first"===a&&this.sorter(n,null!=(e=this.val)?e:n)<=0&&(this.val=n),"last"===a&&0<=this.sorter(n,null!=(e=this.val)?e:n))return this.val=n},value:function(){return this.val},format:function(t){return isNaN(t)?t:o(t)},numInputs:null!=r?0:1}}}},quantile:function(a,o){return null==o&&(o=f),function(t){var r=t[0];return function(t,e,n){return{vals:[],push:function(t){t=parseFloat(t[r]);if(!isNaN(t))return this.vals.push(t)},value:function(){var t;return 0===this.vals.length?null:(this.vals.sort(function(t,e){return t-e}),t=(this.vals.length-1)*a,(this.vals[Math.floor(t)]+this.vals[Math.ceil(t)])/2)},format:o,numInputs:null!=r?0:1}}}},runningStat:function(a,o,i){return null==a&&(a="mean"),null==o&&(o=1),null==i&&(i=f),function(t){var r=t[0];return function(t,e,n){return{n:0,m:0,s:0,push:function(t){var e=parseFloat(t[r]);if(!isNaN(e))return this.n+=1,1===this.n?this.m=e:(t=this.m+(e-this.m)/this.n,this.s=this.s+(e-this.m)*(e-t),this.m=t)},value:function(){if("mean"===a)return 0===this.n?NaN:this.m;if(this.n<=o)return 0;switch(a){case"var":return this.s/(this.n-o);case"stdev":return Math.sqrt(this.s/(this.n-o))}},format:i,numInputs:null!=r?0:1}}}},sumOverSum:function(o){return null==o&&(o=f),function(t){var r=t[0],a=t[1];return function(t,e,n){return{sumNum:0,sumDenom:0,push:function(t){if(isNaN(parseFloat(t[r]))||(this.sumNum+=parseFloat(t[r])),!isNaN(parseFloat(t[a])))return this.sumDenom+=parseFloat(t[a])},value:function(){return this.sumNum/this.sumDenom},format:o,numInputs:null!=r&&null!=a?0:2}}}},sumOverSumBound80:function(o,i){return null==o&&(o=!0),null==i&&(i=f),function(t){var r=t[0],a=t[1];return function(t,e,n){return{sumNum:0,sumDenom:0,push:function(t){if(isNaN(parseFloat(t[r]))||(this.sumNum+=parseFloat(t[r])),!isNaN(parseFloat(t[a])))return this.sumDenom+=parseFloat(t[a])},value:function(){var t=o?1:-1;return(.821187207574908/this.sumDenom+this.sumNum/this.sumDenom+1.2815515655446004*t*Math.sqrt(.410593603787454/(this.sumDenom*this.sumDenom)+this.sumNum*(1-this.sumNum/this.sumDenom)/(this.sumDenom*this.sumDenom)))/(1+1.642374415149816/this.sumDenom)},format:i,numInputs:null!=r&&null!=a?0:2}}}},fractionOf:function(a,o,i){return null==o&&(o="total"),null==i&&(i=m),function(){var r=1<=arguments.length?C.call(arguments,0):[];return function(t,e,n){return{selector:{total:[[],[]],row:[e,[]],col:[[],n]}[o],inner:a.apply(null,r)(t,e,n),push:function(t){return this.inner.push(t)},format:i,value:function(){return this.inner.value()/t.getAggregator.apply(t,this.selector).inner.value()},numInputs:a.apply(null,r)().numInputs}}}},countUnique:function(t){return u.uniques(function(t){return t.length},t)},listUnique:function(e){return u.uniques(function(t){return t.sort($).join(e)},function(t){return t})},max:function(t){return u.extremes("max",t)},min:function(t){return u.extremes("min",t)},first:function(t){return u.extremes("first",t)},last:function(t){return u.extremes("last",t)},median:function(t){return u.quantile(.5,t)},average:function(t){return u.runningStat("mean",1,t)},var:function(t,e){return u.runningStat("var",t,e)},stdev:function(t,e){return u.runningStat("stdev",t,e)}}).count(i),"Count Unique Values":o.countUnique(i),"List Unique Values":o.listUnique(", "),Sum:o.sum(f),"Integer Sum":o.sum(i),Average:o.average(f),Median:o.median(f),"Sample Variance":o.var(1,f),"Sample Standard Deviation":o.stdev(1,f),Minimum:o.min(f),Maximum:o.max(f),First:o.first(f),Last:o.last(f),"Sum over Sum":o.sumOverSum(f),"80% Upper Bound":o.sumOverSumBound80(!0,f),"80% Lower Bound":o.sumOverSumBound80(!1,f),"Sum as Fraction of Total":o.fractionOf(o.sum(),"total",m),"Sum as Fraction of Rows":o.fractionOf(o.sum(),"row",m),"Sum as Fraction of Columns":o.fractionOf(o.sum(),"col",m),"Count as Fraction of Total":o.fractionOf(o.count(),"total",m),"Count as Fraction of Rows":o.fractionOf(o.count(),"row",m),"Count as Fraction of Columns":o.fractionOf(o.count(),"col",m)},W={en:{aggregators:t,renderers:a={Table:function(t,e){return c(t,e)},"Table Barchart":function(t,e){return P(c(t,e)).barchart()},Heatmap:function(t,e){return P(c(t,e)).heatmap("heatmap",e)},"Row Heatmap":function(t,e){return P(c(t,e)).heatmap("rowheatmap",e)},"Col Heatmap":function(t,e){return P(c(t,e)).heatmap("colheatmap",e)}},localeStrings:{renderError:"An error occurred rendering the PivotTable results.",computeError:"An error occurred computing the PivotTable results.",uiRenderError:"An error occurred rendering the PivotTable UI.",selectAll:"Select All",selectNone:"Select None",tooMany:"(too many to list)",filterResults:"Filter values",apply:"Apply",cancel:"Cancel",totals:"Totals",vs:"vs",by:"by"}}},s=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],l=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],g=function(t){return("0"+t).substr(-2,2)},e={bin:function(e,n){return function(t){return t[e]-t[e]%n}},dateFormat:function(e,r,t,a,o){var i;return null==t&&(t=!1),null==a&&(a=s),null==o&&(o=l),i=t?"UTC":"",function(t){var n=new Date(Date.parse(t[e]));return isNaN(n)?"":r.replace(/%(.)/g,function(t,e){switch(e){case"y":return n["get"+i+"FullYear"]();case"m":return g(n["get"+i+"Month"]()+1);case"n":return a[n["get"+i+"Month"]()];case"d":return g(n["get"+i+"Date"]());case"w":return o[n["get"+i+"Day"]()];case"x":return n["get"+i+"Day"]();case"H":return g(n["get"+i+"Hours"]());case"M":return g(n["get"+i+"Minutes"]());case"S":return g(n["get"+i+"Seconds"]());default:return"%"+e}})}}},h=/(\d+)|(\D+)/g,d=/\d/,p=/^0/,$=function(t,e){var n,r,a,o,i,l;if(null!=e&&null==t)return-1;if(null!=t&&null==e)return 1;if("number"==typeof t&&isNaN(t))return-1;if("number"==typeof e&&isNaN(e))return 1;if((i=+t)<(l=+e))return-1;if(l<i)return 1;if("number"==typeof t&&"number"!=typeof e)return-1;if("number"==typeof e&&"number"!=typeof t)return 1;if("number"==typeof t&&"number"==typeof e)return 0;if(isNaN(l)&&!isNaN(i))return-1;if(isNaN(i)&&!isNaN(l))return 1;if((n=String(t))===(a=String(e)))return 0;if(!d.test(n)||!d.test(a))return a<n?1:-1;for(n=n.match(h),a=a.match(h);n.length&&a.length;)if((r=n.shift())!==(o=a.shift()))return d.test(r)&&d.test(o)?r.replace(p,".0")-o.replace(p,".0"):o<r?1:-1;return n.length-a.length},o=function(t){var e,n,r={},a={};for(e in t)n=t[e],r[n]=e,"string"==typeof n&&(a[n.toLowerCase()]=e);return function(t,e){return null!=r[t]&&null!=r[e]?r[t]-r[e]:null!=r[t]?-1:null!=r[e]?1:null!=a[t]&&null!=a[e]?a[t]-a[e]:null!=a[t]?-1:null!=a[e]?1:$(t,e)}},G=function(t,e){var n;if(null!=t)if(P.isFunction(t)){if(n=t(e),P.isFunction(n))return n}else if(null!=t[e])return t[e];return $},v.forEachRecord=function(t,r,a){var e,n,o,i,l,s,u,c,d,h,p,f=P.isEmptyObject(r)?a:function(t){var e,n;for(e in r)n=r[e],t[e]=null!=(n=n(t))?n:t[e];return a(t)};if(P.isFunction(t))return t(f);if(P.isArray(t)){if(P.isArray(t[0])){for(n in d=[],t)if(Y.call(t,n)&&(e=t[n],0<n)){for(o in u={},c=t[0])Y.call(c,o)&&(i=c[o],u[i]=e[o]);d.push(f(u))}return d}for(h=[],l=0,s=t.length;l<s;l++)u=t[l],h.push(f(u));return h}if(t instanceof P)return p=[],P("thead > tr > th",t).each(function(t){return p.push(P(this).text())}),P("tbody > tr",t).each(function(t){return u={},P("td",this).each(function(t){return u[p[t]]=P(this).text()}),f(u)});throw new Error("unknown input format")},v.prototype.forEachMatchingRecord=function(r,a){return v.forEachRecord(this.input,this.derivedAttributes,(o=this,function(t){var e,n;if(o.filter(t)){for(e in r)if(r[e]!==(null!=(n=t[e])?n:"null"))return;return a(t)}}));var o},v.prototype.arrSort=function(r){var a,o=function(){for(var t=[],e=0,n=r.length;e<n;e++)a=r[e],t.push(G(this.sorters,a));return t}.call(this);return function(t,e){var n,r;for(r in o)if(Y.call(o,r)&&0!==(n=(0,o[r])(t[r],e[r])))return n;return 0}},v.prototype.sortKeys=function(){var n,r;if(!this.sorted){switch(this.sorted=!0,n=function(t,e){return r.getAggregator(t,e).value()},(r=this).rowOrder){case"value_a_to_z":this.rowKeys.sort(function(t,e){return $(n(t,[]),n(e,[]))});break;case"value_z_to_a":this.rowKeys.sort(function(t,e){return-$(n(t,[]),n(e,[]))});break;default:this.rowKeys.sort(this.arrSort(this.rowAttrs))}switch(this.colOrder){case"value_a_to_z":return this.colKeys.sort(function(t,e){return $(n([],t),n([],e))});case"value_z_to_a":return this.colKeys.sort(function(t,e){return-$(n([],t),n([],e))});default:return this.colKeys.sort(this.arrSort(this.colAttrs))}}},v.prototype.getColKeys=function(){return this.sortKeys(),this.colKeys},v.prototype.getRowKeys=function(){return this.sortKeys(),this.rowKeys},v.prototype.processRecord=function(t){for(var e,n,r,a,o,i,l,s,u=[],c=[],d=this.colAttrs,h=0,p=d.length;h<p;h++)s=d[h],u.push(null!=(o=t[s])?o:"null");for(a=0,r=(i=this.rowAttrs).length;a<r;a++)s=i[a],c.push(null!=(l=t[s])?l:"null");if(n=c.join(String.fromCharCode(0)),e=u.join(String.fromCharCode(0)),this.allTotal.push(t),0!==c.length&&(this.rowTotals[n]||(this.rowKeys.push(c),this.rowTotals[n]=this.aggregator(this,c,[])),this.rowTotals[n].push(t)),0!==u.length&&(this.colTotals[e]||(this.colKeys.push(u),this.colTotals[e]=this.aggregator(this,[],u)),this.colTotals[e].push(t)),0!==u.length&&0!==c.length)return this.tree[n]||(this.tree[n]={}),this.tree[n][e]||(this.tree[n][e]=this.aggregator(this,c,u)),this.tree[n][e].push(t)},v.prototype.getAggregator=function(t,e){var n=t.join(String.fromCharCode(0)),r=e.join(String.fromCharCode(0)),r=0===t.length&&0===e.length?this.allTotal:0===t.length?this.colTotals[r]:0===e.length?this.rowTotals[n]:this.tree[n][r];return null!=r?r:{value:function(){return null},format:function(){return""}}},J=v,P.pivotUtilities={aggregatorTemplates:u,aggregators:t,renderers:a,derivers:e,locales:W,naturalSort:$,numberFormat:r,sortAs:o,PivotData:J},c=function(i,l){var t,e,s,n,r,a,o,u,c,d,h,p,f,m,g,v,b,C,y,w,A,x,S={table:{clickCallback:null,rowTotals:!0,colTotals:!0},localeStrings:{totals:"Totals"}};for(u in l=P.extend(!0,{},S,l),s=i.colAttrs,d=i.rowAttrs,p=i.getRowKeys(),r=i.getColKeys(),l.table.clickCallback&&(a=function(e,t,n){var r,a,o={};for(a in s)Y.call(s,a)&&(r=s[a],null!=n[a]&&(o[r]=n[a]));for(a in d)Y.call(d,a)&&(r=d[a],null!=t[a]&&(o[r]=t[a]));return function(t){return l.table.clickCallback(t,e,o,i)}}),(S=document.createElement("table")).className="pvtTable",f=function(t,e,n){var r,a,o,i,l,s,u,c;if(0!==e){for(i=!0,c=r=0,l=n;0<=l?r<=l:l<=r;c=0<=l?++r:--r)t[e-1][c]!==t[e][c]&&(i=!1);if(i)return-1}for(a=0;e+a<t.length;){for(u=!1,c=o=0,s=n;0<=s?o<=s:s<=o;c=0<=s?++o:--o)t[e][c]!==t[e+a][c]&&(u=!0);if(u)break;a++}return a},b=document.createElement("thead"),s)if(Y.call(s,u)){for(o in e=s[u],y=document.createElement("tr"),0===parseInt(u)&&0!==d.length&&((v=document.createElement("th")).setAttribute("colspan",d.length),v.setAttribute("rowspan",s.length),y.appendChild(v)),(v=document.createElement("th")).className="pvtAxisLabel",v.textContent=e,y.appendChild(v),r)Y.call(r,o)&&(n=r[o],-1!==(x=f(r,parseInt(o),parseInt(u)))&&((v=document.createElement("th")).className="pvtColLabel",v.textContent=n[u],v.setAttribute("colspan",x),parseInt(u)===s.length-1&&0!==d.length&&v.setAttribute("rowspan",2),y.appendChild(v)));0===parseInt(u)&&l.table.rowTotals&&((v=document.createElement("th")).className="pvtTotalLabel pvtRowTotalLabel",v.innerHTML=l.localeStrings.totals,v.setAttribute("rowspan",s.length+(0===d.length?0:1)),y.appendChild(v)),b.appendChild(y)}if(0!==d.length){for(o in y=document.createElement("tr"),d)Y.call(d,o)&&(c=d[o],(v=document.createElement("th")).className="pvtAxisLabel",v.textContent=c,y.appendChild(v));v=document.createElement("th"),0===s.length&&(v.className="pvtTotalLabel pvtRowTotalLabel",v.innerHTML=l.localeStrings.totals),y.appendChild(v),b.appendChild(y)}for(o in S.appendChild(b),m=document.createElement("tbody"),p)if(Y.call(p,o)){for(u in h=p[o],y=document.createElement("tr"),h)Y.call(h,u)&&(w=h[u],-1!==(x=f(p,parseInt(o),parseInt(u)))&&((v=document.createElement("th")).className="pvtRowLabel",v.textContent=w,v.setAttribute("rowspan",x),parseInt(u)===d.length-1&&0!==s.length&&v.setAttribute("colspan",2),y.appendChild(v)));for(u in r)Y.call(r,u)&&(n=r[u],A=(t=i.getAggregator(h,n)).value(),(g=document.createElement("td")).className="pvtVal row"+o+" col"+u,g.textContent=t.format(A),g.setAttribute("data-value",A),null!=a&&(g.onclick=a(A,h,n)),y.appendChild(g));!l.table.rowTotals&&0!==s.length||(A=(C=i.getAggregator(h,[])).value(),(g=document.createElement("td")).className="pvtTotal rowTotal",g.textContent=C.format(A),g.setAttribute("data-value",A),null!=a&&(g.onclick=a(A,h,[])),g.setAttribute("data-for","row"+o),y.appendChild(g)),m.appendChild(y)}if(l.table.colTotals||0===d.length){for(u in y=document.createElement("tr"),!l.table.colTotals&&0!==d.length||((v=document.createElement("th")).className="pvtTotalLabel pvtColTotalLabel",v.innerHTML=l.localeStrings.totals,v.setAttribute("colspan",d.length+(0===s.length?0:1)),y.appendChild(v)),r)Y.call(r,u)&&(n=r[u],A=(C=i.getAggregator([],n)).value(),(g=document.createElement("td")).className="pvtTotal colTotal",g.textContent=C.format(A),g.setAttribute("data-value",A),null!=a&&(g.onclick=a(A,[],n)),g.setAttribute("data-for","col"+u),y.appendChild(g));!l.table.rowTotals&&0!==s.length||(A=(C=i.getAggregator([],[])).value(),(g=document.createElement("td")).className="pvtGrandTotal",g.textContent=C.format(A),g.setAttribute("data-value",A),null!=a&&(g.onclick=a(A,[],[])),y.appendChild(g)),m.appendChild(y)}return S.appendChild(m),S.setAttribute("data-numrows",p.length),S.setAttribute("data-numcols",r.length),S},P.fn.pivot=function(t,e,n){var r,a,o,i,l,s;null==n&&(n="en"),null==W[n]&&(n="en"),r={cols:[],rows:[],vals:[],rowOrder:"key_a_to_z",colOrder:"key_a_to_z",dataClass:J,filter:function(){return!0},aggregator:u.count()(),aggregatorName:"Count",sorters:{},derivedAttributes:{},renderer:c},n={rendererOptions:{localeStrings:n=P.extend(!0,{},W.en.localeStrings,W[n].localeStrings)},localeStrings:n},o=P.extend(!0,{},n,P.extend({},r,e)),l=null;try{i=new o.dataClass(t,o);try{l=o.renderer(i,o.rendererOptions)}catch(t){a=t,"undefined"!=typeof console&&null!==console&&console.error(a.stack),l=P("<span>").html(o.localeStrings.renderError)}}catch(t){a=t,"undefined"!=typeof console&&null!==console&&console.error(a.stack),l=P("<span>").html(o.localeStrings.computeError)}for(s=this[0];s.hasChildNodes();)s.removeChild(s.lastChild);return this.append(l)},P.fn.pivotUI=function(t,e,n,r){var a,p,f,o,b,i,m,l,s,C,g,u,c,d,h,v,y,w,A,x,S,N,T,k,O,_,F,D,E,M,R,I,L,U,K,q,z,V,j,H,B;null==n&&(n=!1),null==r&&(r="en"),null==W[r]&&(r="en"),l={derivedAttributes:{},aggregators:W[r].aggregators,renderers:W[r].renderers,hiddenAttributes:[],hiddenFromAggregators:[],hiddenFromDragDrop:[],menuLimit:500,cols:[],rows:[],vals:[],rowOrder:"key_a_to_z",colOrder:"key_a_to_z",dataClass:J,exclusions:{},inclusions:{},unusedAttrsVertical:85,autoSortUnusedAttrs:!1,onRefresh:null,showUI:!0,filter:function(){return!0},sorters:{}},r={rendererOptions:{localeStrings:v=P.extend(!0,{},W.en.localeStrings,W[r].localeStrings)},localeStrings:v},v=this.data("pivotUIOptions"),x=null==v||n?P.extend(!0,{},r,P.extend({},l,e)):v;try{for(H in b={},y=[],T=0,J.forEachRecord(t,x.derivedAttributes,function(t){var e,n,r;if(x.filter(t)){for(e in y.push(t),t)Y.call(t,e)&&null==b[e]&&(b[e]={},0<T&&(b[e].null=T));for(e in b)r=null!=(n=t[e])?n:"null",null==(n=b[e])[r]&&(n[r]=0),b[e][r]++;return T++}}),q=P("<table>",{class:"pvtUi"}).attr("cellpadding",5),R=P("<td>").addClass("pvtUiCell"),M=P("<select>").addClass("pvtRenderer").appendTo(R).bind("change",function(){return D()}),k=x.renderers)Y.call(k,H)&&P("<option>").val(H).html(H).appendTo(M);if(z=P("<td>").addClass("pvtAxisContainer pvtUnused pvtUiCell"),L=function(){var t=[];for(a in b)Q.call(x.hiddenAttributes,a)<0&&t.push(a);return t}(),U=function(){for(var t=[],e=0,n=L.length;e<n;e++)i=L[e],Q.call(x.hiddenFromAggregators,i)<0&&t.push(i);return t}(),K=function(){for(var t=[],e=0,n=L.length;e<n;e++)i=L[e],Q.call(x.hiddenFromDragDrop,i)<0&&t.push(i);return t}(),j=!1,V="auto"===x.unusedAttrsVertical?120:parseInt(x.unusedAttrsVertical),!isNaN(V)){for(u=o=0,c=K.length;u<c;u++)o+=(a=K[u]).length;j=V<o}for(C in!0===x.unusedAttrsVertical||j?z.addClass("pvtVertList"):z.addClass("pvtHorizList"),s=function(e){var t,n,r,a,o,i,l,s,u,c,d,h,p,f,m=function(){var t=[];for(h in b[e])t.push(h);return t}(),g=!1,v=P("<div>").addClass("pvtFilterBox").hide();if(v.append(P("<h4>").append(P("<span>").text(e),P("<span>").addClass("count").text("("+m.length+")"))),m.length>x.menuLimit)v.append(P("<p>").html(x.localeStrings.tooMany));else for(5<m.length&&(d=P("<p>").appendTo(v),c=G(x.sorters,e),s=x.localeStrings.filterResults,P("<input>",{type:"text"}).appendTo(d).attr({placeholder:s,class:"pvtSearch"}).bind("keyup",function(){var a=P(this).val().toLowerCase().trim(),t=function(n,r){return function(t){var e=a.substring(n.length).trim();return 0===e.length||(e=Math.sign(c(t.toLowerCase(),e)),0<=Q.call(r,e))}},e=0===a.indexOf(">=")?t(">=",[1,0]):0===a.indexOf("<=")?t("<=",[-1,0]):0===a.indexOf(">")?t(">",[1]):0===a.indexOf("<")?t("<",[-1]):0===a.indexOf("~")?function(t){return 0===a.substring(1).trim().length||t.toLowerCase().match(a.substring(1))}:function(t){return-1!==t.toLowerCase().indexOf(a)};return v.find(".pvtCheckContainer p label span.value").each(function(){return e(P(this).text())?P(this).parent().parent().show():P(this).parent().parent().hide()})}),d.append(P("<br>")),P("<button>",{type:"button"}).appendTo(d).html(x.localeStrings.selectAll).bind("click",function(){return v.find("input:visible:not(:checked)").prop("checked",!0).toggleClass("changed"),!1}),P("<button>",{type:"button"}).appendTo(d).html(x.localeStrings.selectNone).bind("click",function(){return v.find("input:visible:checked").prop("checked",!1).toggleClass("changed"),!1})),n=P("<div>").addClass("pvtCheckContainer").appendTo(v),l=0,i=(u=m.sort(G(x.sorters,e))).length;l<i;l++)p=u[l],f=b[e][p],a=P("<label>"),o=!1,x.inclusions[e]?o=Q.call(x.inclusions[e],p)<0:x.exclusions[e]&&(o=0<=Q.call(x.exclusions[e],p)),g=g||o,P("<input>").attr("type","checkbox").addClass("pvtFilter").attr("checked",!o).data("filter",[e,p]).appendTo(a).bind("change",function(){return P(this).toggleClass("changed")}),a.append(P("<span>").addClass("value").text(p)),a.append(P("<span>").addClass("count").text("("+f+")")),n.append(P("<p>").append(a));return r=function(){return v.find("[type='checkbox']").length>v.find("[type='checkbox']:checked").length?t.addClass("pvtFilteredAttribute"):t.removeClass("pvtFilteredAttribute"),v.find(".pvtSearch").val(""),v.find(".pvtCheckContainer p").show(),v.hide()},d=P("<p>").appendTo(v),m.length<=x.menuLimit&&P("<button>",{type:"button"}).text(x.localeStrings.apply).appendTo(d).bind("click",function(){return v.find(".changed").removeClass("changed").length&&D(),r()}),P("<button>",{type:"button",class:"btn-cancel"}).text(x.localeStrings.cancel).appendTo(d).bind("click",function(){return v.find(".changed:checked").removeClass("changed").prop("checked",!1),v.find(".changed:not(:checked)").removeClass("changed").prop("checked",!0),r()}),d=P("<span>").addClass("pvtTriangle").html(" &#x25BE;").bind("click",function(t){var e=P(t.currentTarget),n=e.offset(),t=e.offsetParent().offsetParent().offset();v.css({position:"fixed",display:"block",visibility:"hidden",top:0,left:0});e={position:"",display:"block",visibility:""};return n.top+25+v.height()>P(document).height()?(e.left=n.left-t.left,e.top=n.top-t.top-v.height()):(e.left=n.left-t.left,e.top=n.top-t.top+25),v.css(e).trigger("pvt.filterbox.shown")}),t=P("<li>").addClass("axis_"+C).append(P("<span>").addClass("pvtAttr").text(e).data("attrName",e).append(d)),g&&t.addClass("pvtFilteredAttribute"),z.append(t).append(v)},K)Y.call(K,C)&&s(f=K[C]);for(H in V=P("<tr>").appendTo(q),p=P("<select>").addClass("pvtAggregator").bind("change",function(){return D()}),O=x.aggregators)Y.call(O,H)&&p.append(P("<option>").val(H).html(H));for(S={key_a_to_z:{rowSymbol:"&varr;",colSymbol:"&harr;",next:"value_a_to_z"},value_a_to_z:{rowSymbol:"&darr;",colSymbol:"&rarr;",next:"value_z_to_a"},value_z_to_a:{rowSymbol:"&uarr;",colSymbol:"&larr;",next:"key_a_to_z"}},I=P("<a>",{role:"button"}).addClass("pvtRowOrder").data("order",x.rowOrder).html(S[x.rowOrder].rowSymbol).bind("click",function(){return P(this).data("order",S[P(this).data("order")].next),P(this).html(S[P(this).data("order")].rowSymbol),D()}),m=P("<a>",{role:"button"}).addClass("pvtColOrder").data("order",x.colOrder).html(S[x.colOrder].colSymbol).bind("click",function(){return P(this).data("order",S[P(this).data("order")].next),P(this).html(S[P(this).data("order")].colSymbol),D()}),P("<td>").addClass("pvtVals pvtUiCell").appendTo(V).append(p).append(I).append(m).append(P("<br>")),P("<td>").addClass("pvtAxisContainer pvtHorizList pvtCols pvtUiCell").appendTo(V),(V=P("<tr>").appendTo(q)).append(P("<td>").addClass("pvtAxisContainer pvtRows pvtUiCell").attr("valign","top")),N=P("<td>").attr("valign","top").addClass("pvtRendererArea").appendTo(V),!0===x.unusedAttrsVertical||j?(q.find("tr:nth-child(1)").prepend(R),q.find("tr:nth-child(2)").prepend(z)):q.prepend(P("<tr>").append(R).append(z)),this.html(q),_=x.cols,w=0,d=_.length;w<d;w++)H=_[w],this.find(".pvtCols").append(this.find(".axis_"+P.inArray(H,K)));for(F=x.rows,A=0,h=F.length;A<h;A++)H=F[A],this.find(".pvtRows").append(this.find(".axis_"+P.inArray(H,K)));null!=x.aggregatorName&&this.find(".pvtAggregator").val(x.aggregatorName),null!=x.rendererName&&this.find(".pvtRenderer").val(x.rendererName),x.showUI||this.find(".pvtUiCell").hide(),g=!0,B=this,E=function(){var a,e,t,n,r,o,i,l,s,u,c={derivedAttributes:x.derivedAttributes,localeStrings:x.localeStrings,rendererOptions:x.rendererOptions,sorters:x.sorters,cols:[],rows:[],dataClass:x.dataClass},d=null!=(u=x.aggregators[p.val()]([])().numInputs)?u:0,h=[];if(B.find(".pvtRows li span.pvtAttr").each(function(){return c.rows.push(P(this).data("attrName"))}),B.find(".pvtCols li span.pvtAttr").each(function(){return c.cols.push(P(this).data("attrName"))}),B.find(".pvtVals select.pvtAttrDropdown").each(function(){return 0===d?P(this).remove():(d--,""!==P(this).val()?h.push(P(this).val()):void 0)}),0!==d)for(o=B.find(".pvtVals"),H=l=0,i=d;0<=i?l<i:i<l;H=0<=i?++l:--l){for(n=P("<select>").addClass("pvtAttrDropdown").append(P("<option>")).bind("change",function(){return D()}),s=0,t=U.length;s<t;s++)f=U[s],n.append(P("<option>").val(f).text(f));o.append(n)}if(g&&(h=x.vals,C=0,B.find(".pvtVals select.pvtAttrDropdown").each(function(){return P(this).val(h[C]),C++}),g=!1),c.aggregatorName=p.val(),c.vals=h,c.aggregator=x.aggregators[p.val()](h),c.renderer=x.renderers[M.val()],c.rowOrder=I.data("order"),c.colOrder=m.data("order"),a={},B.find("input.pvtFilter").not(":checked").each(function(){var t=P(this).data("filter");return null!=a[t[0]]?a[t[0]].push(t[1]):a[t[0]]=[t[1]]}),e={},B.find("input.pvtFilter:checked").each(function(){var t=P(this).data("filter");if(null!=a[t[0]])return null!=e[t[0]]?e[t[0]].push(t[1]):e[t[0]]=[t[1]]}),c.filter=function(t){var e,n,r;if(!x.filter(t))return!1;for(n in a)if(e=a[n],r=""+(null!=(r=t[n])?r:"null"),0<=Q.call(e,r))return!1;return!0},N.pivot(y,c),r=P.extend({},x,{cols:c.cols,rows:c.rows,colOrder:c.colOrder,rowOrder:c.rowOrder,vals:h,exclusions:a,inclusions:e,inclusionsInfo:e,aggregatorName:p.val(),rendererName:M.val()}),B.data("pivotUIOptions",r),x.autoSortUnusedAttrs&&(u=B.find("td.pvtUnused.pvtAxisContainer"),P(u).children("li").sort(function(t,e){return $(P(t).text(),P(e).text())}).appendTo(u)),N.css("opacity",1),null!=x.onRefresh)return x.onRefresh(r)},(D=function(){return N.css("opacity",.5),setTimeout(E,10)})(),this.find(".pvtAxisContainer").sortable({update:function(t,e){if(null==e.sender)return D()},connectWith:this.find(".pvtAxisContainer"),items:"li",placeholder:"pvtPlaceholder"})}catch(t){"undefined"!=typeof console&&null!==console&&console.error(t.stack),this.html(x.localeStrings.uiRenderError)}return this},P.fn.heatmap=function(t,e){var a,n,r,o,i,l,s,u,c,d,h,p;switch(null==t&&(t="heatmap"),u=this.data("numrows"),s=this.data("numcols"),null==(a=null!=e&&null!=(c=e.heatmap)?c.colorScaleGenerator:void 0)&&(a=function(t){var e=Math.min.apply(Math,t),n=Math.max.apply(Math,t);return function(t){t=255-Math.round(255*(t-e)/(n-e));return"rgb(255,"+t+","+t+")"}}),p=this,n=function(t){var n,e=function(e){return p.find(t).each(function(){var t=P(this).data("value");if(null!=t&&isFinite(t))return e(t,P(this))})},r=[];return e(function(t){return r.push(t)}),n=a(r),e(function(t,e){return e.css("background-color",n(t))})},t){case"heatmap":n(".pvtVal");break;case"rowheatmap":for(r=i=0,d=u;0<=d?i<d:d<i;r=0<=d?++i:--i)n(".pvtVal.row"+r);break;case"colheatmap":for(o=l=0,h=s;0<=h?l<h:h<l;o=0<=h?++l:--l)n(".pvtVal.col"+o)}return n(".pvtTotal.rowTotal"),n(".pvtTotal.colTotal"),this},P.fn.barchart=function(t){var e,n,r,a,o,i=this.data("numrows");this.data("numcols");for(o=this,e=function(t){var e,i,n,l,r=function(e){return o.find(t).each(function(){var t=P(this).data("value");if(null!=t&&isFinite(t))return e(t,P(this))})},a=[];return r(function(t){return a.push(t)}),(e=Math.max.apply(Math,a))<0&&(e=0),n=e,(i=Math.min.apply(Math,a))<0&&(n=e-i),l=function(t){return 100*t/(1.4*n)},r(function(t,e){var n=e.text(),r=P("<div>").css({position:"relative",height:"55px"}),a="gray",o=0;return i<0&&(o=l(-i)),t<0&&(o+=l(t),a="darkred",t=-t),r.append(P("<div>").css({position:"absolute",bottom:o+"%",left:0,right:0,height:l(t)+"%","background-color":a})),r.append(P("<div>").text(n).css({position:"relative","padding-left":"5px","padding-right":"5px"})),e.css({padding:0,"padding-top":"5px","text-align":"center"}).html(r)})},n=r=0,a=i;0<=a?r<a:a<r;n=0<=a?++r:--r)e(".pvtVal.row"+n);return e(".pvtTotal.colTotal"),this}})}).call(this);